<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <title>IG-Repacks / Login</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">


    <!-- Additional CSS Files -->
    <link rel="stylesheet" href="assets/css/fontawesome.css">
    <link rel="stylesheet" href="assets/css/igstyle.css">
    <link rel="stylesheet" href="assets/css/owl.css">
    <link rel="stylesheet" href="assets/css/animate.css">
    <link rel="stylesheet"href="https://unpkg.com/swiper@7/swiper-bundle.min.css"/>
    <link rel="icon" href="assets/images/favicon.png">
      <style>
          .input-container input {
              margin: 5px;
              padding: 10px;
              border: 1px solid rgba(255, 255, 255, 0.45);
              border-radius: 15px;
              background-color: transparent;
              color: rgba(255, 255, 255, 0.73); /* Text color */
              font-size: 16px;
          }

          .input-container input::placeholder {
              color: white; /* Placeholder text color */
          }
          .input-container {
              margin-bottom: 10px;
              display: flex;
              flex-direction: column;
          }

          .nav-tabs {
              justify-content: center;
              border: 1px solid rgba(255, 255, 255, 0.5);
              border-radius: 15px;
          }

          .nav-tabs .nav-link {
              background-color: transparent;
              color: rgba(255, 255, 255, 0.45);
              border: 1px solid transparent;
              border-radius: 15px;
              margin: 0 5px;
          }

          .nav-tabs .nav-link.active {
              background-color: rgba(255, 255, 255, 0.02);
              color: white;
              border: 1px solid white;
          }

          .nav-tabs .nav-link:hover {
              border: 1px solid white;
          }

          .nav-item {
              margin: 7px;
          }
      </style>
  </head>

<body>

<script>
    if (localStorage.getItem("user")) {
        localStorage.removeItem("user");
        window.location.href = "/";
    }
</script>
  <div id="progressOverlay">
      <div class="progress-container">
          <div class="circle"></div>
      </div>
  </div>
  <!-- ***** Preloader Start ***** -->
  <div id="js-preloader" class="js-preloader">
    <div class="preloader-inner">
      <span class="dot"></span>
      <div class="dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </div>
  <!-- ***** Preloader End ***** -->

  <!-- ***** Header Area Start ***** -->
  <header class="header-area header-sticky">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <nav class="main-nav">
                    <!-- ***** Logo Start ***** -->
                    <a href="index.html" class="logo">
                        <img src="assets/images/logo.png" alt="">
                    </a>
                    <!-- ***** Logo End ***** -->
                    <!-- ***** Search End ***** -->
                    <div class="search-input">
                      <form id="search" action="/search.html">
                        <input type="text" placeholder="Type Something" id='searchText' name="searchKeyword" onkeypress="handle" />
                        <i class="fa fa-search"></i>
                      </form>
                    </div>
                    <!-- ***** Search End ***** -->
                    <!-- ***** Menu Start ***** -->
                    <ul class="nav" style="place-content: space-evenly;">
                        <li><a href="index.html">Home</a></li>
                        <li><a href="browse.html">Games</a></li>
                        <li><a href="https://www.facebook.com/iraqighost9393">Subscribe</a></li>
                        <li><a href="login.html">Profile <img src="assets/images/profile-header.jpg" alt=""></a></li>
                    </ul>
                  <a class='menu-trigger'>
                      <span>Menu</span>
                  </a>
                  <!-- ***** Menu End ***** -->
                </nav>
            </div>
        </div>
    </div>
  </header>
  <!-- ***** Header Area End ***** -->

  <div class="container">
      <div class="row">
          <div class="col-lg-12">
              <div class="page-content" style="padding: 1px 10px 10px 10px">
                  <div class="most-popular" style="margin-bottom: 10px; margin-top: 16px">
                      <div class="row">
                          <div class="col-lg-12">
                              <ul class="nav nav-tabs" id="myTab" role="tablist">
                                  <li class="nav-item" role="presentation">
                                      <a class="nav-link active" id="login-tab" data-bs-toggle="tab" href="#login" role="tab" aria-controls="login" aria-selected="true">Login</a>
                                  </li>
                                  <li class="nav-item" role="presentation">
                                      <a class="nav-link" id="register-tab" data-bs-toggle="tab" href="#register" role="tab" aria-controls="register" aria-selected="false">Register</a>
                                  </li>
                              </ul>
                              <div class="tab-content" id="myTabContent">
                                  <div class="tab-pane fade show active" id="login" role="tabpanel" aria-labelledby="login-tab">
                                      <div class="heading-section">
                                          <div class="input-container">
                                              <input id="email" type="email" placeholder="Email" required>
                                              <input id="password" type="password" placeholder="Password" required>
                                          </div>
                                          <div class="row">
                                              <div class="col-lg-12">
                                                  <div class="main-button">
                                                      <a style="color: white" onclick="goLogin();">Login</a>
                                                  </div>
                                              </div>
                                          </div>
                                      </div>
                                  </div>
                                  <div class="tab-pane fade" id="register" role="tabpanel" aria-labelledby="register-tab">
                                      <!-- Registration form goes here -->
                                      <div class="heading-section">
                                          <div class="input-container">
                                              <input id="reg-name" type="text" placeholder="Name" required>
                                              <input id="reg-email" type="email" placeholder="Email" required>
                                              <input id="reg-password" type="password" placeholder="Password" required>
                                          </div>
                                          <div class="row">
                                              <div class="col-lg-12">
                                                  <div class="main-button">
                                                      <a style="color: white" onclick="goRegister();">Register</a>
                                                  </div>
                                              </div>
                                          </div>
                                      </div>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </div>
  </div>

  <!-- Add Bootstrap JS if not already included -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>


  <footer>
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <p>Copyright Â© <span id="currentYear"></span> <a href="#">IG-Repacks</a>
            <br>Design: <a href="https://fb.com/noabrahemno" target="_blank" title="ibrahim khalid">Ibrahim Khalid</a></p>
        </div>

        <script>
          const year = new Date().getFullYear();
          document.getElementById('currentYear').textContent = year;
        </script>

      </div>
    </div>
  </footer>


  <!-- Scripts -->
  <!-- Bootstrap core JavaScript -->


  <!-- Login Script -->
  <script type="module">
      import { auth } from './assets/js/firebase-init.js'; // Update the path accordingly
      import { signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";
      import {
          getFirestore,
          setDoc,
          doc,
          getDoc, updateDoc
      } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

      const db = getFirestore();

      async function goLogin() {
          showProgressCircle();
          const email = document.getElementById('email').value;
          const password = document.getElementById('password').value;

          try {
              const userCredential = await signInWithEmailAndPassword(auth, email, password);
              const user = userCredential.user;
              console.log(userCredential);

              // Fetch the user's data from Firestore
              const userDocRef = doc(db, 'users', user.uid);
              const userDocSnapshot = await getDoc(userDocRef);

              if (userDocSnapshot.exists()) {
                  const userData = userDocSnapshot.data();
                  const name = userData.name || "";
                  const premium = userData.premium || false;
                  const admin = userData.admin || false;
                  localStorage.setItem("user", JSON.stringify({
                      uid: user.uid,
                      name: name,
                      email: user.email,
                      admin: admin,
                      premium: premium,
                      password: password
                  }));

              } else {
                  localStorage.setItem("user", JSON.stringify({
                      uid: user.uid,
                      name: "",
                      email: user.email
                  }));
                  console.error("No user document found!");
              }

              // Redirect after successful login
              window.location.href = "/";
          } catch (error) {
              console.error("Error logging in:", error);
              alert("There may be no account for this email, if you have an account on IG-Repacks, contact us on live chat for help.");
          } finally {
              hideProgressCircle();
          }
      }

      function goRegister() {
          showProgressCircle();
          const name = document.getElementById('reg-name').value;
          const email = document.getElementById('reg-email').value;
          const password = document.getElementById('reg-password').value;
          const emailLogin = document.getElementById('email');
          const passwordLogin = document.getElementById('password');
          createUserWithEmailAndPassword(auth, email, password)
              .then(async (userCredential) => {
                  const user = userCredential.user;
                  console.log("User registered:", user.email);

                  // Add user data to Firestore
                  const userDocRef = doc(db, 'users', user.uid);
                  await setDoc(userDocRef, {
                      name: name,
                      email: email
                  });
                  emailLogin.value = email;
                  passwordLogin.value = password;
                  alert("Account Created Successfully");
                  hideProgressCircle();
                  goLogin();
              })
              .catch(error => {
                  hideProgressCircle();
                  console.error("Error registering:", error);
                  if (error.toString().includes("email-already-in-use")) {
                      alert("This email is already registered, try a new email")
                  } else {
                      alert("There is a problem creating the account, contact us on live chat for help");
                  }
              });
      }

      window.goLogin = goLogin;
      window.goRegister = goRegister;

  </script>

  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.min.js"></script>

  <script src="assets/js/isotope.min.js"></script>
  <script src="assets/js/owl-carousel.js"></script>
  <script src="assets/js/tabs.js"></script>
  <script src="assets/js/popup.js"></script>
  <script src="assets/js/custom.js?v=2"></script>

  <script>
      // Show the progress circle overlay
      function showProgressCircle() {
          document.getElementById('progressOverlay').style.display = 'block';
      }

      // Hide the progress circle overlay
      function hideProgressCircle() {
          document.getElementById('progressOverlay').style.display = 'none';
      }
  </script>
  </body>

</html>
